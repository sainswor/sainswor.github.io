{{- if and .Site.Params.staticman (not (or .Site.Params.disable_comments .Params.disable_comments)) }}
    <section id="comments">
        {{- if .Site.Params.staticman }}
        {{- $comments := readDir "data/comments" }}
        {{- $postSlug := .File.ContentBaseName }}
        <div id="comment-wrapper">
         <h4 id="comments">Discussion ({{- .Scratch.Get "hasComments" }}) ¬</h4>
        <section class="staticman-comments post-comments">
            <ol class="commentlist">
        {{- range $comments }}
            {{- if eq .Name $postSlug }}                
                {{- range $index, $comments := (index $.Site.Data.comments $postSlug ) }}
                    {{- if and (not .reply_to) (.comment)  }}
                    <li id="comment-{{- ._id }}" class="comment even thread-even depth-1">
                        <div class="comment-avatar">
                        <img title="{{- .name }}" alt="" src="https://www.gravatar.com/avatar/{{-     .email }}?s=128&r=pg&d=mp" class="avatar avatar-64 photo instant nocorner itxtalt" height="64" width="64"></div>
                        <div class="comment-content">
                            <div class="comment-author vcard">
                            {{- if not (eq .website "") }}
                            <cite title="{{- .website }}"><a href="{{- .website }}" title="{{- .name }}" class="external nofollow">{{- .name }}</a></cite>
                            {{- else }}
                            <cite>{{- .name }}</cite>		
                            {{- end }}
                            </div>
                            <div class="comment-meta-data">
                                <span class="comment-time">
                                    {{- .date | time.Format ":date_long"}}, {{- .date | time.Format ":time_short" }}				</span>
                    
                                    <span class="comment-permalink">
                                        <span class="separator">|</span> <a href="#commentid-{{- ._id }}" title="Permalink to comment">#</a>
                                    </span>
                    
                                    <span class="comment-reply-link">
                                        <span class="separator">|</span>
                                        <a rel="nofollow" class="comment-reply-link" href="#comment-form" onclick="changeValue('fields[reply_to]', '{{- ._id }}')">Reply</a></span>	
                    
                                    </div>
                    
                                    <div class="comment-text">
                            <p>{{- .comment | markdownify }}</p>
                        </div>
                                            
                    </div>
                    
                    <div class="clear"></div>

                    {{- $active_replies := (slice "000") }}
                    {{- $comparator := ._id }}
                    {{- range $index, $comments := (index $.Site.Data.comments $postSlug ) }}
                        {{- if eq .reply_to $comparator }}
                            {{- $active_replies = $active_replies | append ._id }}
                        {{- end}}
                    {{- end }}
                    {{- $active_replies = $active_replies | symdiff (slice "000") }}
                    {{- .Scratch.Set "commentDepth" 1 }}
                    {{- if not (eq (len $active_replies) 0) }}
                        <ul class="children">
                        {{- partial "comment-replies" (dict "postId" $postSlug "SiteDataComments_parent" $.Site.Data.comments "parentId" ._id "activeReplies" $active_replies "context" .) }}
                        </ul>
                    {{- end }}
                    </li>
                {{- end }}
            {{- end }}
        {{- end }}
    {{- end }}
</ol>
        <div class="comment-wrapper-respond">
            <div id="respond" class="comment-respond">
                <h3 id="reply-title" class="comment-reply-title">Comment ¬</h3>				
                <form id="comment-form" onsubmit="disableButton()" class="post-new-comment" method="post" action="{{- .Site.Params.staticman.endpoint }}/{{- .Site.Params.staticman.username }}/{{- .Site.Params.staticman.repository }}/{{- .Site.Params.staticman.branch }}/comments" >
                        <p class="comment-notes">
                            <span id="email-notes">Your email address will not be published.</span>
                             Required fields are marked <span class="required">*</span>
                        </p>
                        <p class="comment-form-comment">
                            <textarea id="comment" name="fields[comment]" class="comment-textarea"></textarea>
                        </p>
                        <p class="comment-form-author">
                            <input id="fields[name]" name="fields[name]" type="text" value="" size="30" required/> 
                            <label for="fields[name]"><small>*NAME</small></label>
                        </p>
                        <p class="comment-form-email">
                            <input id="fields[email]" name="fields[email]" type="text" value="" size="30" required/>
                            <label for="fields[email]">*EMAIL<small> — <a href="https://gravatar.com/">Get a Gravatar</a></small></label>
                        </p>
    
                        <p class="comment-form-url">
                            <input id="fields[website]" name="fields[website]" type="text" value="" size="30"> 
                            <label for="fields[website]">Website URL</label>
                        </p>
                        <div class="g-recaptcha" data-sitekey="6LdXD0AcAAAAADoSoDQZNTvDEuHvMlARgS_lPXxH"></div>
                        <p class="form-submit">
                            <!-- post-comment-field btn btn-primary comment-buttons -->
                            <button name="submit" type="submit" id="submit" class="submit">Post Comment</button>
                            
                            <input type="hidden" id="fields[reply_to]" name="fields[reply_to]" value="">
                            <input type="hidden" name="options[redirect]" value="{{- .Permalink }}#comment-submitted">
                            <input type="hidden" name="options[slug]" value="{{- .File.ContentBaseName }}">
                        </p>
                </form>
            </div><!-- #respond -->
        </div>






    </section>

    <div id="comment-submitted" class="dialog" style="visibility: hidden; display: none;">
        <h3>Thank you!</h3>
        <p>Your comment has been submitted and will be published once it has been approved.</p>

        <p><a href="#" class="btn btn-primary comment-buttons ok">OK</a></p>
    </div>

    {{- end }}
</section>
<script>
function changeValue(elementID, commentID ){
        document.getElementById(elementID).value = commentID;
}
function disableButton() {
        var btn = document.getElementById('submit');
        btn.disabled = true;
        btn.innerText = 'Posting...'
}
</script>
{{- end }}